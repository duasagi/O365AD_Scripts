name: Exchange Online - App Cert Connection

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  connect-exchange:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup PowerShell
        uses: PowerShell/setup-powershell@v2

      - name: Connect to Exchange Online using Certificate
        shell: pwsh
        env:
          APP_ID: ${{ secrets.APP_ID }}
          TENANT_ID: ${{ secrets.TENANT_ID }}
          CERT_THUMBPRINT: ${{ secrets.CERT_THUMBPRINT }}
          CERT_BASE64: ${{ secrets.CERT_BASE64 }}
          CERT_PASSWORD: ${{ secrets.CERT_PASSWORD }}
        run: |
          # Display PowerShell version (for debugging)
          Write-Host "PowerShell version:" $PSVersionTable.PSVersion

          # Run the PowerShell script
          .\exchange-connect.ps1 `
            -AppId $env:APP_ID `
            -TenantId $env:TENANT_ID `
            -Thumbprint $env:CERT_THUMBPRINT `
            -CertBase64 $env:CERT_BASE64 `
            -CertPassword $env:CERT_PASSWORD
